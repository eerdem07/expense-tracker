datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           String       @id @default(cuid())
  email        String       @unique
  passwordHash String
  locale       String       @default("tr-TR")
  timezone     String       @default("Europe/Istanbul")
  baseCurrency String       @default("TRY")
  createdAt    DateTime     @default(now())

  wallets      Wallet[]
  categories   Category[]
  transactions Transaction[]
}

model Wallet {
  id             String        @id @default(cuid())
  userId         String
  name           String
  type           WalletType
  currency       String
  openingBalance Decimal       @default(0)
  archived       Boolean       @default(false)
  createdAt      DateTime      @default(now())

  user           User          @relation(fields: [userId], references: [id])
  transactions   Transaction[]

  @@unique([userId, name])    // aynı isimli cüzdanı engelle
}

enum WalletType {
  cash
  bank
  credit
}

model Category {
  id        String        @id @default(cuid())
  userId    String
  name      String
  type      CategoryType
  parentId  String?

  user      User          @relation(fields: [userId], references: [id])
  parent    Category?     @relation("CategoryToCategory", fields: [parentId], references: [id])
  children  Category[]    @relation("CategoryToCategory")
  transactions Transaction[]

  @@unique([userId, name, type]) // aynı tipte aynı isimli kategori olmasın
}

enum CategoryType {
  income
  expense
}

model Transaction {
  id         String           @id @default(cuid())
  userId     String
  walletId   String
  type       TransactionType
  amount     Decimal
  currency   String
  bookedAt   DateTime
  categoryId String?
  note       String?
  attachments String[]        @default([])
  tags        String[]        @default([])

  user       User             @relation(fields: [userId], references: [id])
  wallet     Wallet           @relation(fields: [walletId], references: [id])
  category   Category?        @relation(fields: [categoryId], references: [id])

  @@index([userId, bookedAt])
  @@index([userId, type])
  @@index([userId, walletId])
  @@index([userId, categoryId])
}

enum TransactionType {
  income
  expense
  transfer
}
